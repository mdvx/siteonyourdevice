<html>
    <head>
        <link rel="stylesheet" href="style/style.css">
        <script src="scripts/script.js" type="text/javascript"></script>
        <script src="http://siteonyourdevice.com:3000/socket.io/socket.io.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script>
            
            //socket io client
            //var io = require('socket.io');
            var socket = io.connect('http://siteonyourdevice.com:3000');
            
            var id_command = 11;
            var user_id = get_url_parameter('id');
            var user_cookie_hash = get_url_parameter('hash');
            
            var server_name = undefined;
            
            //on connetion, updates connection state and sends subscribe request
            socket.on('connect', function(data){
                socket.emit('subscribe', {channel:CHANNEL_OUT});
                socket.emit('subscribe', {channel:CHANNEL_CLIENTS_STATE});
            });

            //when reconnection is attempted, updates status 
            socket.on('reconnecting', function(data){
            });

            //on new message adds a new message to display
            socket.on('message', function (data) {
                var msg = data.text;
                
                if (data.channel === CHANNEL_OUT) {
                    var msgObj = parse_command_out(msg);
                    if(msgObj == undefined){
                        return;
                    }
                    
                    if(id_command !== msgObj.id){
                        return;
                    }
                    
                    var is_ok = is_succsess_command(msgObj);
                    
                    if(is_ping_command(msgObj)){
                        
                    }
                    else if(is_info_command(msgObj)){
                    
                    }
                    else if(is_shutdown_command(msgObj)){
                    
                    }
                }
                else if(data.channel === CHANNEL_CLIENTS_STATE){
                    var stateObj = parse_state_msg(msg);
                    if(stateObj == undefined){
                        return;
                    }
                    
                    if(stateObj.status == CONNECTED_STATUS.CONNECTED){
                        $('.status_label').html(SERVER_STATUS.ONLINE);
                        $('.ping_button').disabled = false;
                        $('.info_button').disabled = false; 
                        $('.shutdown_button').disabled = false;
                    }
                    else{
                        $('.status_label').html(SERVER_STATUS.OFFLINE);
                        $('.ping_button').disabled = true;
                        $('.info_button').disabled = true; 
                        $('.shutdown_button').disabled = true;
                    }
                }
                
               
            });

            function init()
            {
                var server_name_local = get_url_parameter('site');
                if(server_name_local !== undefined){
                    server_name = server_name_local;
                }
                $('.server_name_label').html(server_name === undefined ? SERVER_DEFAULT_LABEL : server_name);
                $('.status_label').html(SERVER_STATUS.OFFLINE);
                $('.cpu_label').html(SERVER_CPU_DEFAULT_LABEL);
            }
        </script>

    </head>
    <body onload = "init()">
        <form>
        <fieldset>
            <legend class="server_name_label"></legend>
            Status: <label class="status_label"></label><br>
            Cpu: <label class="cpu_label"></label>
        </fieldset>
        </form>
        <button class="ping_button" value="disable" onclick="ping_server(id_command, server_name, socket)">Ping</button>
        <button class="info_button" value="disable" onclick="server_info(id_command, server_name, socket)">Info</button>
        <button class="shutdown_button" value="disable" onclick="shutdown_server(id_command, server_name, socket)">Shutdown</button>
    </body>
</html>
